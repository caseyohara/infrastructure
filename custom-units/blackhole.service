# Unit file generated from generators/blackhole-service.sh
[Unit]
Description=block malicious ssh connections
After=sshd.service
Requires=sshd.service

[Service]
# Script encoded from scripts/blackhole.sh
ExecStart=/bin/sh -c 'echo "c2V0IC1lbyBwaXBlZmFpbAoKIyBDaGVjayB0byBzZWUgaWYgdGhlIHByb2dyYW0gaXMgcnVubmluZywgZXJyb3IgaWYgaXQgaXMKaWYgWyAtZiAvdmFyL3J1bi9ibGFja2hvbGUucGlkIF0gOyB0aGVuCiAgZWNobyAiQWNjb3JkaW5nIHRvIC92YXIvcnVuL2JsYWNraG9sZS5waWQsIHRoaXMgc2NyaXB0IGlzIGFscmVhZHkgcnVubmluZy4gRXhpdGluZy4iIDE+JjIgOwogIGV4aXQgMSA7CmZpIDsKCiMgVHJhY2sgdGhlIHByb2Nlc3MKZWNobyAkQkFTSFBJRCA+IC92YXIvcnVuL2JsYWNraG9sZS5waWQgOwoKIyBLZXlzCmV4cG9ydCBXSElURUxJU1RfS0VZPS9ibGFja2hvbGUvd2hpdGVsaXN0CmV4cG9ydCBCTEFDS0xJU1RfS0VZPS9ibGFja2hvbGUvd2hpdGVsaXN0CgojIEVuc3VyZSBuYW1lc3BhY2VzIGFyZSBjcmVhdGVkCmV0Y2RjdGwgbWtkaXIgJFdISVRFTElTVF9LRVkKZXRjZGN0bCBta2RpciAkQkxBQ0tMSVNUX0tFWQoKYWRkX3RvX3doaXRlbGlzdCgpewogIGlmICEgZXRjZGN0bCBnZXQgIiRXSElURUxJU1RfS0VZIi8iJGlwIiA+IC9kZXYvbnVsbCAyPiYxIDsgdGhlbgogICAgZGF0ZSB8IGV0Y2RjdGwgc2V0ICIkV0hJVEVMSVNUX0tFWSIvIiRpcCIKICBmaQp9CgphZGRfdG9fYmxhY2tsaXN0KCl7CiAgaWYgISBldGNkY3RsIGdldCAiJEJMQUNLTElTVF9LRVkiLyIkaXAiID4gL2Rldi9udWxsIDI+JjEgOyB0aGVuCiAgICBkYXRlIHwgZXRjZGN0bCBzZXQgIiRCTEFDS0xJU1RfS0VZIi8iJGlwIgogIGZpCn0KCmlzX3doaXRlbGlzdGVkKCl7CiAgaXA9JDEKICBpZiAhIGV0Y2RjdGwgZ2V0ICIkV0hJVEVMSVNUX0tFWSIvIiRpcCIgPiAvZGV2L251bGwgMj4mMSB7CiAgICBmYWxzZQogIH0gZWxzZSB7CiAgICB0cnVlCiAgfQp9CgojIFdoaXRlbGlzdCBmbGVldCBtYWNoaW5lcwooCiAgbGFzdCAtLXRpbWUtZm9ybWF0IG5vdGltZSAtYXdpIHwgZ3JlcCBwdHMgfCBjdXQgLWMzOC0KICBmbGVldGN0bCBsaXN0LW1hY2hpbmVzIC0tZmllbGRzPWlwIC1uby1sZWdlbmQKKSB8IHNvcnQgfCB1bmlxIHwgXAp3aGlsZSByZWFkIGlwIDsgZG8KICBhZGRfdG9fd2hpdGVsaXN0ICRpcApkb25lCgojIFNjYW5uaW5nIFByb2dyYW0KKAogIC91c3IvYmluL2pvdXJuYWxjdGwgLWYgLW8ganNvbiB8IFwKICBncmVwIC0tbGluZS1idWZmZXJlZCBzc2hkIHwgXAogIGdyZXAgLS1saW5lLWJ1ZmZlcmVkIC1lICJEaXNjb25uZWN0aW5nOiBUb28gbWFueSBhdXRoZW50aWNhdGlvbiBmYWlsdXJlc1x8RmFpbGVkIHBhc3N3b3JkIGZvciIgfCBcCiAgc2VkIC11IC1lICJzL14uKnNzaGRALio6MjItLy8iIC1lICJzLzouKiQvLyIgfCBcCiAgd2hpbGUgcmVhZCBpcCA7IGRvCiAgICBhZGRfdG9fYmxhY2tsaXN0ICRpcAogIGRvbmUgJiBSRUFERVJfUElEPSQhCiAgKCggSk9VUk5BTENUTF9QSUQ9UkVBREVSX1BJRCsxICkpIDsKICBfdGVybSgpIHsgZWNobyBLaWxsaW5nIGpvdXJuYWxjdGwgcGlkICRKT1VSTkFMQ1RMX1BJRCAyPiYxIDsKICAgIGtpbGwgJEpPVVJOQUxDVExfUElEIDsKICAgIGV4aXQgMCA7CiAgfSA7CiAgdHJhcCBfdGVybSBTSUdJTlQgU0lHVEVSTSBFWElUIDsKICB3YWl0ICRSRUFERVJfUElECikgJiBTQ0FOTkVSX1BJRD0kISsxIDsKCgojIEJsb2NrZXIgUHJvZ3JhbQojIFdhdGNoZXMgZm9yIG5ldyBrZXlzIGluIGV0Y2QgYW5kIGJsb2NrcyB0aGVtCigKICBldGNkY3RsIGV4ZWMtd2F0Y2ggLS1yZWN1cnNpdmUgL2JsYWNraG9sZS9ibGFja2xpc3QgLS0gc2ggLWMgJwogICAgaXA9JChlY2hvICRFVENEX1dBVENIX0tFWSB8IHNlZCAicy8uKlwvLy8iKQogICAgaWYgISBpc193aGl0ZWxpc3RlZCA7IHRoZW4KICAgICAgKGlwIHJvdXRlIGFkZCBibGFja2hvbGUgIiRpcCIgJiYgZWNobyAiYWRkZWQgIiRpcCIgdG8gYmxvY2sgbGlzdCIpIHwgdHJ1ZQogICAgZmkKICAnICYgV0FUQ0hFUl9QSUQ9JCEKCiAgX3Rlcm0oKSB7IGVjaG8gS2lsbGluZyBldGRjdGwgcGlkICRXQVRDSEVSX1BJRCAyPiYxCiAgICBraWxsICRXQVRDSEVSX1BJRAogICAgZXhpdCAwCiAgfQogIHRyYXAgX3Rlcm0gU0lHSU5UIFNJR1RFUk0gRVhJVAogIHdhaXQgJFdBVENIRVJfUElECikgJiBCTE9DS0VSX1BJRD0kISsxCgojIEV4aXN0aW5nIEtleSBCbG9ja2VyCiMgQmxvY2tzIGFsbCBleGlzdGluZyBrZXlzIGluIGV0Y2QKZm9yIGtleSBpbiAkKGV0Y2RjdGwgbHMgL2JsYWNraG9sZS9ibGFja2xpc3QpIDsgZG8KICBpcD0kKGVjaG8gJGtleSB8IHNlZCAicy8uKlwvLy8iKQogIGlmICEgaXNfd2hpdGVsaXN0ZWQgOyB0aGVuCiAgICAoaXAgcm91dGUgYWRkIGJsYWNraG9sZSAiJGlwIiAmJiBlY2hvICJhZGRlZCAiJGlwIiB0byBibG9jayBsaXN0IikgfCB0cnVlCiAgZmkKZG9uZQoKIyBUZXJtaW5hdGlvbiBTY3JpcHQKX3Rlcm0oKSB7CiAgZWNobyAiS2lsbGluZyBCbGFja2hvbGUgUHJvY2Vzc2VzIiAgMj4mMQogIGtpbGwgJFNDQU5ORVJfUElEID4gL2Rldi9udWxsIDI+JjEgfHwgdHJ1ZQogIGtpbGwgJEJMT0NLRVJfUElEID4gL2Rldi9udWxsIDI+JjEgfHwgdHJ1ZQogIHJtIC1mIC92YXIvcnVuL2JsYWNraG9sZS5waWQKICBleGl0IDAKfQp0cmFwIF90ZXJtIFNJR0lOVCBTSUdURVJNIEVYSVQKZWNobyAkQkFTSFBJRCA+IC92YXIvcnVuL2JsYWNraG9sZS5waWQKd2FpdCAkU0NBTk5FUl9QSUQKd2FpdCAkQkxPQ0tFUl9QSUQK" | base64 -d | bash'

[X-Fleet]
MachineMetadata=bastion

